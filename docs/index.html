<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nour Shawky">

<title>When Machines Learn Our Biases: The Real-World Consequences</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-838cb846b2414f11caac439a21f6b75f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="quarto-light">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#what-is-a-bias" id="toc-what-is-a-bias" class="nav-link active" data-scroll-target="#what-is-a-bias">What is a Bias?</a></li>
  <li><a href="#why-is-this-important" id="toc-why-is-this-important" class="nav-link" data-scroll-target="#why-is-this-important">Why is this important?</a></li>
  <li><a href="#case-study-durhams-policing-algorithm-hart" id="toc-case-study-durhams-policing-algorithm-hart" class="nav-link" data-scroll-target="#case-study-durhams-policing-algorithm-hart">Case Study: Durham’s Policing Algorithm (HART)</a></li>
  <li><a href="#long-term-consequences" id="toc-long-term-consequences" class="nav-link" data-scroll-target="#long-term-consequences">Long-term consequences</a></li>
  <li><a href="#whats-the-solution" id="toc-whats-the-solution" class="nav-link" data-scroll-target="#whats-the-solution">What’s the Solution?</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">When Machines Learn Our Biases: The Real-World Consequences</h1>
<p class="subtitle lead">Understanding how historical data shapes modern machine learning systems</p>
</div>



<div class="quarto-title-meta column-page-left">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nour Shawky </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="profile_pic_2.jpg" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Figure 1: The Cycle of Bias — How seemingly harmless data can propogate extremely harmful biases (Leslie, 2021)</figcaption>
</figure>
</div>
<p><br></p>
<p>Currently, machine learning models rely on vast datasets in order to be able to produce accurate and reliable outcomes. Whether that is using a dataset of bank transactions to learn how to detect fraud or using a dataset of emails to learn the patterns of spam. But applications of AI and machine learning algorithms go beyond this. In the last few years, they’ve been implemented in high-stake applications such as criminal court sentencing decisions, policing algorithms, patient diagnoses and to automate job hiring processes.</p>
<p>Just image how much automation goes on behind the scenes? Let me give you an idea. ’According to research, 77% of companies are either using or exploring the use of AI in their businesses, and 83% of companies claim that AI is a top priority in their business plans (Prestianni, 2025).”</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="AI_stats.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Figure 2: Reasons for the adoption of AI and ML in industry</figcaption>
</figure>
</div>
<p>Although machine learning is a subset of AI, it’s application in industry is similarly vast. So let us breakdown what we mean by bias and why they are problematic during the development of such models.</p>
<section id="what-is-a-bias" class="level3">
<h3 class="anchored" data-anchor-id="what-is-a-bias">What is a Bias?</h3>
<p>A bias is the tendency to lean or favor a particular ideology or standpoint. What about a historical bias? These emerge from past social, racial, political and economic prejudice, and become systematically implemented in data over time.</p>
</section>
<section id="why-is-this-important" class="level3">
<h3 class="anchored" data-anchor-id="why-is-this-important">Why is this important?</h3>
<p>If the goal is to build and deploy reliable models that can help alleviate the human labor involved in many processes, we need to ensure that these systems learn as many meaningful patterns as possible from existing data, whilst fairly and accurately representing the contexts and people they are meant to serve. Additionally, this also maintains trust and transparency in machine learning and the use of AI in real-world applications.</p>
<p><strong>Fundamental Goal:</strong> Develop and Deploy advancements in data science whilst maintaining fairness and equity.</p>
<p>Many companies now rely on these automated systems in order to make decisions. In fact, ‘An estimated 99% of Fortune 500 companies now use some form of automation in their hiring process’ (Milne, 2024). Take for instance, company X, which is in the process of recruiting a new full-time lead machine learning engineer. Of course, while historical biases present in the data used to build such an algorithm are often unavoidable, it is still important to recognize that systematic discrimination exists and is often embedded in a lot of the data used to build these algorithms. If this company blindly trains a model on such data, after conducting all the necessary cleaning, preprocessing and transformations of course, it may find that many of the outcomes tend to favor candidates from certain backgrounds, discrediting those from marginalized communities, not because of their technical ability, but because of the inherent racial bias present in the data that was not acknowledged during the training phase. Back in 2015, it was actually found that Amazon, one of the largest tech companies today, used an AI recruiting tool that was biased against women, largely because it was trained on historical data dominated by male candidates in the tech industry (Dastin, 2018).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="recruitment_bias.jpg" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Figure 3: Visual Representation of recruitment bias in ML-based hiring algorithms</figcaption>
</figure>
</div>
<p>Our responsibility as data scientists isn’t just about building the best performing models or optimizing strategies for feature engineering, but it is also about ensuring that we put out into the world is just and fair. Otherwise, many consequences may arise including lost opportunities, reinforced inequalities and overall reduced trust in AI and machine learning driven processes.</p>
</section>
<section id="case-study-durhams-policing-algorithm-hart" class="level3">
<h3 class="anchored" data-anchor-id="case-study-durhams-policing-algorithm-hart">Case Study: Durham’s Policing Algorithm (HART)</h3>
<p>In 2021, Durham Police was criticised for their use of a flawed AI profiling tool that used ‘crude and discriminatory’ data profiles at the core of it’s algorithm (Fair Trials, 2022). The consequences? Targetted and discriminatory policing of low income neighborhoods, where more individuals were likely to be arrested and charged, with many of the targtted postal codes in the city being labelled as ‘multicultural’ and ‘overcorwded’.</p>
<p>The HART algorithm was also found to have a predictive accuracy of 53.8%, meaning it was likely to make correct predictions approximately half the time, yet continued to be utilized from 2016 to 2021.</p>
</section>
<section id="long-term-consequences" class="level3">
<h3 class="anchored" data-anchor-id="long-term-consequences">Long-term consequences</h3>
<p>Not only can these exacerbated biases be harmful to communities, but the consquences also extend to the tech and data science industries as well. Below I summarise the main long-term conseuqences of flawed training data in machine learning:</p>
<ul>
<li>Unjust loss of oppertunities</li>
<li>Lack of trust in the use of automative technology</li>
<li>Lack of respect for the industry</li>
<li>Lack of transparency and understanding in important decision-making processes</li>
</ul>
</section>
<section id="whats-the-solution" class="level3">
<h3 class="anchored" data-anchor-id="whats-the-solution">What’s the Solution?</h3>
<section id="looking-at-mitigating-strategies" class="level4">
<h4 class="anchored" data-anchor-id="looking-at-mitigating-strategies">Looking at Mitigating Strategies</h4>
<p>Eliminating all forms of bias is nearly impossible, but implementing stratgies that can mitigate their effects is definitely possible.</p>
<p><img src="trust_ML.png" class="img-fluid" style="width:90.0%"></p>
</section>
<section id="data-driven-approaches" class="level4">
<h4 class="anchored" data-anchor-id="data-driven-approaches">1. Data Driven Approaches</h4>
<ul>
<li><strong>Continuing to collect more data</strong>: Collecting more representative data and ensuring certain groups are not underrepresented can help counter the effects of existing datasets that are flawed and biased.</li>
</ul>
</section>
<section id="maintaining-human-oversight" class="level4">
<h4 class="anchored" data-anchor-id="maintaining-human-oversight">2. Maintaining Human Oversight</h4>
<ul>
<li><p><strong>Auditing and evaluating data and model performance</strong>: Data Scientists and other industry professionals should always be evaluating the quality of a dataset with regard to bias. They should continuously conduct thorough exploratory analyses to flag for potential unethical trends that could be captured by a machine learning model. Additionally, continuously evaluate model performance with respect to each subgroup of people, especially vulnerable subgroups.</p>
<ul>
<li><strong>For example:</strong> HR employees should take note if their algorithm shows consistent preference for White Male Applicants compared to other racial minorities.</li>
</ul></li>
<li><p><strong>Keep humans in the decision making process</strong>: When it comes to high stake decisions, avoid complete reliance on automation and model predictions.</p>
<ul>
<li><strong>For example:</strong> In healthcare, the decision for whether a patient should receive chemotherapy or radiation treatment for their cancer diagnoses should not be solely decided by an algorithm. Health data is often flawed whereby it fails to capture important gender, racial and socioeconomic factors influencing health outcomes. Health care professionals should validate model decisions with the full knowledge of a pateint’s demographic and medical history.</li>
</ul></li>
</ul>
<p>As difficult as it may be, adopting an ethical framework even in the world of data science is a must. Without these considerations, there would be catastrophic backlash towards the use of machine learning models in the real-world. It is the responsibility of data scientists and related professions to ensure that historical biases are not further perpetuated by the algorithms they build and continue to generate strategies that attempt to eliminate their harmful effects on the world.</p>
</section>
</section>
<section id="references" class="level3">
<h3 class="anchored" data-anchor-id="references">References:</h3>
<p>Leslie, D., Mazumder, A., Peppin, A., Wolters, M. K., &amp; Hagerty, A. (2021). Does “AI” stand for augmenting inequality in the era of covid-19 healthcare?. bmj, 372.</p>
<p>Prestianni, T. (2025, March 4). 131 AI statistics and trends for 2026. National University. https://www.nu.edu/blog/ai-statistics-trends/</p>
<p>Fair Trials. (2022, August 15). FOI reveals over 12,000 people profiled by flawed Durham police predictive AI tool. Fair Trials. https://www.fairtrials.org/articles/news/foi-reveals-over-12000-people-profiled-by-flawed-durham-police-predictive-ai-tool/</p>
<p>Milne, S. (2024, October 31). AI tools show biases in ranking job applicants’ names according to perceived race and gender. UW News. https://www.washington.edu/news/2024/10/31/ai-bias-resume-screening-race-gender/</p>
<p>Dastin, J. (2018, October 10). Amazon scraps secret AI recruiting tool that showed bias against women. Reuters. https://www.reuters.com/article/world/insight-amazon-scraps-secret-ai-recruiting-tool-that-showed-bias-against-women-idUSKCN1MK0AG/</p>
<p>Word count: 1074</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>